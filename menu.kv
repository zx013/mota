#:kivy 1.10
#:import EventLoop kivy.base.EventLoop
#:import FadeTransition kivy.uix.screenmanager.FadeTransition
#:import Store setting.Store
#:import Setting setting.Setting
#:import Mota mota.Mota
#:import functools functools


<MenuLabel>:
    #简化后的参数
    idx: 0
    idy: 0
    text: ''
    fsize: 4

    #调节配置中的size时不影响菜单
    ssize: (Setting.size + 2) * Setting.multiple
    pos_temp: {'center_x': Setting.pos_rx(self.idx), 'center_y': Setting.pos_ry(self.idy)}

    #根据地图大小动态变化的大小和位置，需要单独使用self.text，否则会为空
    length: max([0.5 * len(s.encode('gbk')) for s in self.text.split('\n')]) if self.text else 0
    line: len(self.text.split('\n')) if self.text else 1
    pos_hint: self.pos_temp
    size: (self.length * self.font_size, self.line * self.font_size)
    size_hint: (None, None)

    #字体
    font_size: 0.8 * self.fsize * self.ssize
    font_name: Setting.font_path

    #是否被选中，初始化状态
    selected: False
    state: 'down' if self.selected else 'normal'

    #选中后的颜色配置
    disabled_color: (1, 1, 1, 1)
    select_color: (1, 1, 0, 1)
    default_color: (1, 1, 1, 1)
    color: self.select_color if self.state == 'down' else self.default_color


<MenuImage>:
    idx: 0
    idy: 0
    name: ''

    pos_hint: Setting.pos_hint(self.idx, self.idy)
    size: (Setting.pos_realx, Setting.pos_realx)
    size_hint: (None, None)
    texture: Texture.next(self.name)
    allow_stretch: True

<MenuParameter>:
    idx: 0
    idy: 0
    text: ''
    attr: 'title'
    min: 0
    max: 100
    MenuLabel:
        idx: self.parent.idx
        idy: self.parent.idy
        text: self.parent.text
        fsize: 3
        disabled: True
    MenuLabel:
        id: base
        idx: self.parent.idx + 5.4
        idy: self.parent.idy
        text: str(getattr(Setting, self.parent.attr))
        fsize: 3
        disabled: True
    MenuLabel:
        idx: self.parent.idx + 9
        idy: self.parent.idy
        text: '+'
        fsize: 3
        on_touch_up:
            self.state = 'normal'
        on_release:
            attr = getattr(Setting, self.parent.attr)
            attr += attr < self.parent.max
            setattr(Setting, self.parent.attr, attr)
            base.text = str(attr)
    MenuLabel:
        idx: self.parent.idx + 12.6
        idy: self.parent.idy
        text: '-'
        fsize: 3
        on_touch_up:
            self.state = 'normal'
        on_release:
            attr = getattr(Setting, self.parent.attr)
            attr -= attr > self.parent.min
            setattr(Setting, self.parent.attr, attr)
            base.text = str(attr)


<MenuSetting>:
    idx: 0
    idy: 0
    type: ''
    MenuLabel:
        idx: self.parent.idx
        idy: self.parent.idy
        text: '基本'
        fsize: 4
        color: self.select_color if self.parent.type == 'base' else self.default_color
        on_touch_up:
            self.state = 'normal'
        on_release:
            Store.save()
            root.root.current = 'setting-base'
    MenuLabel:
        idx: self.parent.idx + 4.2
        idy: self.parent.idy
        text: '|'
        fsize: 6
        disabled: True
    MenuLabel:
        idx: self.parent.idx + 8.4
        idy: self.parent.idy
        text: '操作'
        fsize: 4
        color: self.select_color if self.parent.type == 'operate' else self.default_color
        on_touch_up:
            self.state = 'normal'
        on_release:
            Store.save()
            root.root.current = 'setting-operate'
    MenuLabel:
        idx: self.parent.idx + 12.6
        idy: self.parent.idy
        text: '|'
        fsize: 6
        disabled: True
    MenuLabel:
        idx: self.parent.idx + 16.8
        idy: self.parent.idy
        text: '声音'
        fsize: 4
        color: self.select_color if self.parent.type == 'sound' else self.default_color
        on_touch_up:
            self.state = 'normal'
        on_release:
            Store.save()
            root.root.current = 'setting-sound'
    MenuLabel:
        idx: self.parent.idx + 21
        idy: self.parent.idy
        text: '|'
        fsize: 6
        disabled: True
    MenuLabel:
        idx: self.parent.idx + 25.2
        idy: self.parent.idy
        text: '其它'
        fsize: 4
        color: self.select_color if self.parent.type == 'other' else self.default_color
        on_touch_up:
            self.state = 'normal'
        on_release:
            Store.save()
            root.root.current = 'setting-other'
    MenuLabel:
        idx: 0
        idy: -11.7
        text: '返 回'
        fsize: 3
        on_touch_up:
            self.state = 'normal'
        on_release:
            Store.save()
            root.root.current = 'main'


<MenuMonster>:
    index: 0
    idx: 0.5
    idy: 3 - 10 * self.index
    fsize: 1.9
    opacity: 1
    monster: ('', '')
    maze: self.parent.maze
    canvas:
        Color:
            rgba: (0, 0.78, 0.55, 1)
        Line:
            width: Setting.multiple
            rounded_rectangle: (Setting.pos_x(root.idx - 12.25) - Setting.pos_realx / 2 - 2 * Setting.multiple, Setting.pos_y(root.idy + 7.5) - Setting.pos_realx / 2 - 2 * Setting.multiple, Setting.pos_realx + 4 * Setting.multiple, Setting.pos_realx + 4 * Setting.multiple, 5 * Setting.multiple) if root.idy is not None else (0, 0, 0, 0, 0)
        Color:
            rgba: (0.96, 0.96, 0.96, 1)
        Line:
            width: 1.5 * Setting.multiple
            rounded_rectangle: (Setting.pos_x(root.idx - 0.5) - (Setting.row_show - 1) / Setting.row_show * Setting.row_size / 2 - 1.5 * Setting.multiple, Setting.pos_y(root.idy + 7.5) - 3 / Setting.row_show * Setting.row_size / 2 - 1.5 * Setting.multiple, (Setting.row_show - 1) / Setting.row_show * Setting.row_size + 3 * Setting.multiple, 3 / Setting.row_show * Setting.row_size + 3 * Setting.multiple, Setting.size * Setting.multiple) if root.idy is not None else (0, 0, 0, 0, 0)
    MenuImage:
        idx: root.idx - 12.25
        idy: root.idy + 7.5
        name: 'ground'
        size: (Setting.pos_realx + 2, Setting.pos_realx + 2)
    MenuImage:
        idx: root.idx - 12.25
        idy: root.idy + 7.5
        name: '-'.join(root.monster)
    MenuLabel:
        idx: root.idx - 1
        idy: root.idy + 10.25
        text: ' '.join(str((root.maze.get_monster(root.monster) if root.maze else {}).get('name', '未知')))
        fsize: root.fsize + 0.3
        disabled: True
        color: (0.82, 0.41, 0.12, 1)
    MenuLabel:
        idx: root.idx - 7.75
        idy: root.idy + 8.75
        text: '生命:'
        fsize: root.fsize
        disabled: True
        color: (0.5, 1, 0.5, 1)
    MenuLabel:
        idx: root.idx - 4.75
        idy: root.idy + 8.75
        text: str((root.maze.get_monster(root.monster) if root.maze else {}).get('health', -1))
        fsize: root.fsize
        disabled: True
        color: (0.5, 1, 0.5, 1)
    MenuLabel:
        idx: root.idx + 1.25
        idy: root.idy + 8.75
        text: '攻击:'
        fsize: root.fsize
        disabled: True
        color: (1, 0.5, 0.5, 1)
    MenuLabel:
        idx: root.idx + 4.25
        idy: root.idy + 8.75
        text: str((root.maze.get_monster(root.monster) if root.maze else {}).get('attack', -1))
        fsize: root.fsize
        disabled: True
        color: (1, 0.5, 0.5, 1)
    MenuLabel:
        idx: root.idx + 9.25
        idy: root.idy + 8.75
        text: '防御:'
        fsize: root.fsize
        disabled: True
        color: (0.5, 0.5, 1, 1)
    MenuLabel:
        idx: root.idx + 12.25
        idy: root.idy + 8.75
        text: str((root.maze.get_monster(root.monster) if root.maze else {}).get('defence', -1))
        fsize: root.fsize
        disabled: True
        color: (0.5, 0.5, 1, 1)
    MenuLabel:
        idx: root.idx - 7.75
        idy: root.idy + 6.75
        text: '伤害:'
        fsize: root.fsize
        disabled: True
        color: (1, 0.5, 1, 1)
    MenuLabel:
        idx: root.idx - 4.75
        idy: root.idy + 6.75
        text: str(root.maze.get_damage(root.maze.herostate.attack, root.maze.herostate.defence, root.monster) if root.maze else -1)
        fsize: root.fsize
        disabled: True
        color: (1, 0.5, 1, 1)
    MenuLabel:
        idx: root.idx + 1.25
        idy: root.idy + 6.75
        text: '技能:'
        fsize: root.fsize
        disabled: True
        color: (1, 1, 0.5, 1)
    MenuLabel:
        idx: root.idx + 4.25
        idy: root.idy + 6.75
        text: '魔法' if (root.maze.get_monster(root.monster) if root.maze else {}).get('ismagic', False) else '无'
        fsize: root.fsize - 0.2
        disabled: True
        color: (1, 1, 0.5, 1)
    MenuLabel:
        idx: root.idx - 7.75
        idy: root.idy + 4.75
        text: '金币:'
        fsize: root.fsize
        disabled: True
        color: (1, 0.84, 0, 1)
    MenuLabel:
        idx: root.idx - 4.75
        idy: root.idy + 4.75
        text: str((root.maze.get_monster(root.monster) if root.maze else {}).get('gold', -1))
        fsize: root.fsize
        disabled: True
        color: (1, 0.84, 0, 1)
    MenuLabel:
        idx: root.idx + 1.25
        idy: root.idy + 4.75
        text: '经验:'
        fsize: root.fsize
        disabled: True
        color: (0.53, 0.81, 0.92, 1)
    MenuLabel:
        idx: root.idx + 4.25
        idy: root.idy + 4.75
        text: str((root.maze.get_monster(root.monster) if root.maze else {}).get('experience', -1))
        fsize: root.fsize
        disabled: True
        color: (0.53, 0.81, 0.92, 1)


<MenuMonsterManual>:
    maze: None
    monster_list: ()
    page: 0
    number: 3
    page_prev: page_prev
    page_next: page_next
    MenuMonster:
        index: 0
        monster: root.monster_list[root.page * root.number] if root.page * root.number < len(root.monster_list) else ('', '')
        opacity: 1 if root.page * root.number < len(root.monster_list) else  0
    MenuMonster:
        index: 1
        monster: root.monster_list[root.page * root.number + 1] if root.page * root.number + 1 < len(root.monster_list) else ('', '')
        opacity: 1 if root.page * root.number + 1 < len(root.monster_list) else  0
    MenuMonster:
        index: 2
        monster: root.monster_list[root.page * root.number + 2] if root.page * root.number + 2 < len(root.monster_list) else ('', '')
        opacity: 1 if root.page * root.number + 2 < len(root.monster_list) else  0
    MenuLabel:
        id: page_prev
        idx: -12
        idy: -14.5
        text: '上一页'
        fsize: 2.5
        disabled: root.page <= 0
        disabled_color: (0.5, 0.5, 0.5, 1)
        on_touch_up:
            self.state = 'normal'
        on_release:
            root.page -= root.page > 0
            self.state = 'normal'
            self.color = self.disabled_color if self.disabled else self.default_color
            page_next.color = self.default_color
    MenuLabel:
        id: page_next
        idx: 12
        idy: -14.5
        text: '下一页'
        fsize: 2.5
        disabled: (root.page + 1) * root.number >= len(root.monster_list)
        disabled_color: (0.5, 0.5, 0.5, 1)
        on_touch_up:
            self.state = 'normal'
        on_release:
            root.page += (root.page + 1) * root.number < len(root.monster_list)
            self.state = 'normal'
            self.color = self.disabled_color if self.disabled else self.default_color
            page_prev.color = self.default_color
    MenuLabel:
        idx: 0
        idy: -14.75
        text: '返 回'
        fsize: 2
        on_touch_up:
            self.state = 'normal'
        on_release:
            self.color = self.default_color
            root.root.current = 'mota'


<MenuDialog>:
    idx: 0
    idy: 0
    name: 'hero-blue-down'
    text: ''
    page: 0
    pages: [['', '', '']]
    end: False
    role_label: role_label
    role_image: role_image
    page_prev: page_prev
    page_next: page_next
    page_enter: page_enter
    page_exit: page_exit
    canvas:
        Color:
            rgba: (1, 1, 0, 1)
        Line:
            width: 1.5 * Setting.multiple
            rounded_rectangle: (Setting.pos_x(root.idx - 4) - Setting.pos_realx / 2 - 1.5 * Setting.multiple, Setting.pos_y(root.idy + 1.5) - Setting.pos_realx / 2 - 1.5 * Setting.multiple, Setting.pos_realx + 3 * Setting.multiple, Setting.pos_realx + 3 * Setting.multiple, 5 * Setting.multiple)
        Color:
            rgba: (0.96, 0.96, 0.96, 1)
        Line:
            width: 1.5 * Setting.multiple
            rounded_rectangle: (Setting.pos_x(root.idx) - 5 / Setting.row_show * Setting.row_size / 2 - 1.5 * Setting.multiple, Setting.pos_y(root.idy) - 3 / Setting.row_show * Setting.row_size / 2 - 1.5 * Setting.multiple, 5 / Setting.row_show * Setting.row_size + 3 * Setting.multiple, 3 / Setting.row_show * Setting.row_size + 3 * Setting.multiple, Setting.size * Setting.multiple)
    MenuImage:
        idx: root.idx - 4
        idy: root.idy + 1.5
        name: 'ground'
        size: (Setting.pos_realx + 2, Setting.pos_realx + 2)
    MenuImage:
        id: role_image
        idx: root.idx - 4
        idy: root.idy + 1.5
        name: root.name
    MenuLabel:
        id: role_label
        idx: root.idx + 1.5
        idy: root.idy + 2.5
        text: '英 雄'
        fsize: 2
        disabled: True
    MenuLabel:
        idx: root.idx + 1.85
        idy: root.idy + 0.75
        text: root.pages[root.page][0]
        fsize: 1.5
        disabled: True
    MenuLabel:
        idx: root.idx + 0.1
        idy: root.idy - 0.75
        text: root.pages[root.page][1]
        fsize: 1.5
        disabled: True
    MenuLabel:
        idx: root.idx + 0.1
        idy: root.idy - 2.25
        text: root.pages[root.page][2]
        fsize: 1.5
        disabled: True
    MenuLabel:
        id: page_prev
        idx: root.idx - 4.5
        idy: root.idy - 3.25
        text: '←'
        fsize: 1.5
        disabled: root.page <= 0
        disabled_color: (0.7, 0.7, 0.7, 1)
        on_touch_up:
            self.state = 'normal'
        on_release:
            root.page -= root.page > 0
            self.state = 'normal'
            root.show()
    MenuLabel:
        id: page_enter
        idx: root.idx
        idy: root.idy - 3.25
        text: '○'
        fsize: 1.2
        disabled: root.page < len(root.pages) - 1
        disabled_color: (0.7, 0.7, 0.7, 1)
        on_touch_up:
            self.state = 'normal'
        on_release:
            root.dialog_end() if not root.update() else None
    MenuLabel:
        id: page_next
        idx: root.idx + 4.5
        idy: root.idy - 3.25
        text: '→'
        fsize: 1.5
        disabled: root.page >= len(root.pages) - 1
        disabled_color: (0.7, 0.7, 0.7, 1)
        on_touch_up:
            self.state = 'normal'
        on_release:
            root.page += root.page < len(root.pages) - 1
            self.state = 'normal'
            root.show()
    MenuLabel:
        id: page_exit
        idx: root.idx + 5.25
        idy: root.idy + 2.75
        text: '×'
        fsize: 1.2
        on_touch_up:
            self.state = 'normal'
        on_release:
            root.dialog_end()


<MenuManager>:
    transition: FadeTransition()
    size: (Setting.row_size, Setting.col_size)
    size_hint: (None, None)

    Screen:
        name: 'main'
        step: Setting.title_width / (len(Setting.title) - 1)
        title_x: [- Setting.title_width / 2 + n * self.step for n, c in enumerate(Setting.title)]
        title_y: [7 + (Setting.title_radius ** 2 - x ** 2) ** 0.5 - (Setting.title_radius ** 2 - 14 ** 2) ** 0.5 for x in self.title_x]

        MenuLabel:
            idx: self.parent.title_x[0]
            idy: self.parent.title_y[0]
            text: Setting.title[0]
            fsize: 8
            disabled: True
        MenuLabel:
            idx: self.parent.title_x[1]
            idy: self.parent.title_y[1]
            text: Setting.title[1]
            fsize: 8
            disabled: True
        MenuLabel:
            idx: self.parent.title_x[2]
            idy: self.parent.title_y[2]
            text: Setting.title[2]
            fsize: 8
            disabled: True
        MenuLabel:
            idx: self.parent.title_x[3]
            idy: self.parent.title_y[3]
            text: Setting.title[3]
            fsize: 8
            disabled: True
        MenuLabel:
            idx: self.parent.title_x[4]
            idy: self.parent.title_y[4]
            text: Setting.title[4]
            fsize: 8
            disabled: True
        MenuLabel:
            idx: 0
            idy: 6
            text: ' '.join([c for c in Setting.version])
            fsize: 4
            disabled: True
        MenuLabel:
            idx: 0
            idy: 0
            text: '开 始'
            fsize: 6
            on_touch_up:
                self.state = 'normal'
            on_release:
                root.current = 'start'
        MenuLabel:
            idx: 0
            idy: -6.3
            text: '设 置'
            fsize: 6
            on_touch_up:
                self.state = 'normal'
            on_release:
                root.current = 'setting-base'
        MenuLabel:
            idx: 0
            idy: -11.7
            text: '退 出'
            fsize: 4
            on_touch_up:
                self.state = 'normal'
            on_release:
                EventLoop.exit()

    Screen:
        name: 'start'

        MenuLabel:
            idx: 0
            idy: 4.5
            text: '开 始'
            fsize: 4
            on_touch_up:
                self.state = 'normal'
            on_release:
                root.current = 'mota'
        MenuLabel:
            idx: 0
            idy: 0
            text: '继 续'
            fsize: 4
            on_touch_up:
                self.state = 'normal'
            on_release:
                root.current = 'mota'
                mota.load()
        MenuLabel:
            idx: 0
            idy: -4.5
            text: '返 回'
            fsize: 3
            on_touch_up:
                self.state = 'normal'
            on_release:
                root.current = 'main'

    Screen:
        name: 'mota'
        Mota:
            id: mota
            dialog: dialog
        MenuDialog:
            id: dialog
            mota: mota
            idx: 128
            idy: 128
            opacity: 0
            FloatLayout:
        MenuLabel:
            idx: -14.75
            idy: -7
            text: '↑'
            fsize: 3
            disabled: False #mota.hero.floor + 1 > mota.hero.floor_max
            disabled_color: (0.75, 0.75, 0.75, 1)
            on_touch_up:
                self.state = 'normal'
            on_release:
                mota.floorlabel.text = str(mota.hero.floor_up)
                mota.hero.stair = MazeBase.Value.Stair.up
        MenuLabel:
            idx: -14.75
            idy: -10
            text: '○'
            fsize: 2.4
            disabled: False
            disabled_color: (0.75, 0.75, 0.75, 1)
            on_touch_up:
                self.state = 'normal'
        MenuLabel:
            idx: -14.75
            idy: -13
            text: '↓'
            fsize: 3
            disabled: False #mota.hero.floor - 1 < mota.maze.herostate.floor
            disabled_color: (0.75, 0.75, 0.75, 1)
            on_touch_up:
                self.state = 'normal'
            on_release:
                mota.floorlabel.text = str(mota.hero.floor_down)
                mota.hero.stair = MazeBase.Value.Stair.down
        MenuLabel:
            idx: -14
            idy: -14.5
            text: '怪物'
            fsize: 2
            color: (1, 1, 1, 1)
            #切换到怪物手册时更新怪物列表，可能需要排序
            on_release:
                root.current = 'monster-manual'

    Screen:
        name: 'setting-base'

        MenuSetting:
            idx: -12.6
            idy: 12.6
            type: 'base'
            root: root

        FloatLayout:
            MenuLabel:
                idx: -9
                idy: 7.2
                text: '新 手'
                fsize: 4
                group: 'different'
                allow_no_selection: False
                selected: Setting.difficult_type == 'very-easy'
                on_release: Setting.difficult_type = 'very-easy'
            MenuLabel:
                idx: -9
                idy: 3.6
                text: '容 易'
                fsize: 4
                group: 'different'
                allow_no_selection: False
                selected: Setting.difficult_type == 'easy'
                on_release: Setting.difficult_type = 'easy'
            MenuLabel:
                idx: -9
                idy: 0
                text: '正 常'
                fsize: 4
                group: 'different'
                allow_no_selection: False
                selected: Setting.difficult_type == 'normal'
                on_release: Setting.difficult_type = 'normal'
            MenuLabel:
                idx: -9
                idy: -3.6
                text: '困 难'
                fsize: 4
                group: 'different'
                allow_no_selection: False
                selected: Setting.difficult_type == 'hard'
                on_release: Setting.difficult_type = 'hard'
            MenuLabel:
                idx: -9
                idy: -7.2
                text: '噩 梦'
                fsize: 4
                group: 'different'
                allow_no_selection: False
                selected: Setting.difficult_type == 'very-hard'
                on_release: Setting.difficult_type = 'very-hard'

        MenuParameter:
            idx: 0
            idy: 7.2
            text: '层数'
            attr: 'base'
            min: 2

        MenuParameter:
            idx: 0
            idy: 3.6
            text: '大小'
            attr: 'size'
            min: 3

        FloatLayout:
            MenuLabel:
                idx: 5.4
                idy: 0
                text: '血 量'
                fsize: 3
                selected: Setting.show_health
                on_release: Setting.show_health = not Setting.show_health
            MenuLabel:
                idx: 1.8
                idy: -3.6
                text: '攻 击'
                fsize: 3
                selected: Setting.show_attack
                on_release: Setting.show_attack = not Setting.show_attack
            MenuLabel:
                idx: 9
                idy: -3.6
                text: '防 御'
                fsize: 3
                selected: Setting.show_defence
                on_release: Setting.show_defence = not Setting.show_defence
            MenuLabel:
                idx: 5.4
                idy: -7.2
                text: '伤 害'
                fsize: 3
                selected: Setting.show_damage
                on_release: Setting.show_damage = not Setting.show_damage

    Screen:
        name: 'setting-operate'

        MenuSetting:
            idx: -12.6
            idy: 12.6
            type: 'operate'
            root: root

        MenuLabel:
            idx: 0
            idy: 7.2
            text: '触 控'
            fsize: 4
        MenuLabel:
            idx: -9
            idy: 3.6
            text: '触 控'
            fsize: 3
            group: 'touch'
            allow_no_selection: False
            selected: Setting.touch
            on_release: Setting.touch = True
        MenuLabel:
            idx: 9
            idy: 3.6
            text: '虚 拟'
            fsize: 3
            group: 'touch'
            allow_no_selection: False
            selected: not Setting.touch
            on_release: Setting.touch = False
        MenuLabel:
            idx: 0
            idy: -1.8
            text: '键 盘'
            fsize: 4
            disabled: True
        MenuLabel:
            idx: -9
            idy: -7.2
            text: '      W\nA    S    D'
            fsize: 3
            group: 'keyboard'
            allow_no_selection: False
            selected: Setting.keyboard_wasd
            on_release: Setting.keyboard_wasd = True
        MenuLabel:
            idx: 9
            idy: -7.2
            text: '       ↑\n←   ↓   →'
            fsize: 3
            group: 'keyboard'
            allow_no_selection: False
            selected: not Setting.keyboard_wasd
            on_release: Setting.keyboard_wasd = False

    Screen:
        name: 'setting-sound'

        MenuSetting:
            idx: -12.6
            idy: 12.6
            type: 'sound'
            root: root

        MenuLabel:
            idx: 0
            idy: 7.2
            text: '背 景'
            fsize: 4
            selected: Setting.sound_back
            on_release: Setting.sound_back = not Setting.sound_back
        MenuParameter:
            idx: -5.4
            idy: 3.6
            text: '音 量'
            attr: 'sound_back_volume'
            min: 0
            max: 100
        MenuLabel:
            idx: 0
            idy: -1.8
            text: '音 效'
            fsize: 4
            selected: Setting.sound_effect
            on_release: Setting.sound_effect = not Setting.sound_effect
        MenuParameter:
            idx: -5.4
            idy: -5.4
            text: '音 量'
            attr: 'sound_effect_volume'
            min: 0
            max: 100

    Screen:
        name: 'setting-other'

        MenuSetting:
            idx: -12.6
            idy: 12.6
            type: 'other'
            root: root

        MenuLabel:
            idx: 0
            idy: 7.2
            text: ''
            fsize: 3
            disabled: True
        MenuLabel:
            idx: 0
            idy: 3.6
            text: '制 作:  zx013'
            fsize: 3
            disabled: True
        MenuLabel:
            idx: 0
            idy: 0
            text: '音 乐:  zx013'
            fsize: 3
            disabled: True
        MenuLabel:
            idx: 0
            idy: -3.6
            text: '美 术:  zx013'
            fsize: 3
            disabled: True
        MenuLabel:
            idx: 0
            idy: -7.2
            text: '联系及反馈: zxlib@foxmail.com'
            fsize: 2
            disabled: True

    Screen:
        name: 'monster-manual'
        on_pre_enter:
            monster_manual.monster_list = tuple(set(functools.reduce(lambda x, y: x + y, [[pos[1] for pos in row if pos[0] == MazeBase.Type.Active.monster] for row in mota.maze.maze[mota.maze.herostate.floor]])))
            monster_manual.page = 0
            page_prev = monster_manual.page_prev
            page_next = monster_manual.page_next
            page_prev.color = page_prev.disabled_color if page_prev.disabled else page_prev.default_color
            page_next.color = page_next.disabled_color if page_next.disabled else page_next.default_color
        MenuMonsterManual:
            id: monster_manual
            maze: mota.maze
            monster_list: ()
            root: root


<MenuStatus>:
    size: (Setting.row_size, Setting.status_size * Setting.col_size)
    size_hint: (None, None)
    Screen:
        name: 'start'
        MenuAnimationLabel:
            #pos: (Setting.row_size, 0)
            pos_hint: {}
            #text: Setting.status_text
            fsize: 1.8
            disabled: True


<MenuLayout>:
    MenuManager:
        pos: (0, Setting.status_size * Setting.col_size)
    MenuStatus:
        pos: (0, 0)


